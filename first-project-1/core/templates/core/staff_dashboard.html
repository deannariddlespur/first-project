{% extends 'core/base.html' %}
{% block content %}
<div class="doggy-container">
    <h2>üë®‚Äçüíº Staff Dashboard</h2>
    
    <div class="filter-section">
        <form method="get" class="filter-form">
            <div class="filter-controls">
                <div class="filter-group">
                    <label for="month-filter">Month:</label>
                    <select name="month" id="month-filter" class="filter-control">
                        <option value="1" {% if filter_month == 1 %}selected{% endif %}>January</option>
                        <option value="2" {% if filter_month == 2 %}selected{% endif %}>February</option>
                        <option value="3" {% if filter_month == 3 %}selected{% endif %}>March</option>
                        <option value="4" {% if filter_month == 4 %}selected{% endif %}>April</option>
                        <option value="5" {% if filter_month == 5 %}selected{% endif %}>May</option>
                        <option value="6" {% if filter_month == 6 %}selected{% endif %}>June</option>
                        <option value="7" {% if filter_month == 7 %}selected{% endif %}>July</option>
                        <option value="8" {% if filter_month == 8 %}selected{% endif %}>August</option>
                        <option value="9" {% if filter_month == 9 %}selected{% endif %}>September</option>
                        <option value="10" {% if filter_month == 10 %}selected{% endif %}>October</option>
                        <option value="11" {% if filter_month == 11 %}selected{% endif %}>November</option>
                        <option value="12" {% if filter_month == 12 %}selected{% endif %}>December</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="year-filter">Year:</label>
                    <select name="year" id="year-filter" class="filter-control">
                        <option value="2024" {% if filter_year == 2024 %}selected{% endif %}>2024</option>
                        <option value="2025" {% if filter_year == 2025 %}selected{% endif %}>2025</option>
                        <option value="2026" {% if filter_year == 2026 %}selected{% endif %}>2026</option>
                        <option value="2027" {% if filter_year == 2027 %}selected{% endif %}>2027</option>
                        <option value="2028" {% if filter_year == 2028 %}selected{% endif %}>2028</option>
                    </select>
                </div>
                <button type="submit" class="doggy-btn">Apply Filter</button>
            </div>
        </form>
    </div>
    
    <div class="staff-stats">
        <div class="stat-card">
            <h3>üìä Statistics for {{ month_name }}</h3>
            <p><strong>Total Bookings (All Time):</strong> {{ total_bookings }}</p>
            <p><strong>Bookings This Period:</strong> {{ filtered_bookings }}</p>
            <p><strong>Pending Bookings:</strong> {{ total_pending }}</p>
            <p><strong>Total Revenue:</strong> ${{ total_revenue|default:"0.00" }}</p>
            <p><strong>Pending Payments:</strong> ${{ pending_payments|default:"0.00" }}</p>
            <p><strong>Period:</strong> {{ start_date|date:"m/d/Y" }} to {{ end_date|date:"m/d/Y" }}</p>
        </div>
    </div>
    
    <div class="staff-sections">
        <div class="section">
            <h3>üö® Pending Bookings</h3>
            {% if pending_bookings %}
                <div class="booking-list">
                    {% for booking in pending_bookings %}
                        <div class="booking-item">
                            <strong>{{ booking.dog.name }}</strong> ({{ booking.dog.owner }})
                            <br>
                            <small>{{ booking.start_date|date:"m/d/Y" }} to {{ booking.end_date|date:"m/d/Y" }}</small>
                            {% if booking.total_amount %}
                                <br><small><strong>Amount:</strong> ${{ booking.total_amount }}</small>
                            {% endif %}
                            <br>
                            <a href="{% url 'staff_booking_detail' booking.id %}" class="doggy-btn">Manage</a>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>No pending bookings for this period!</p>
            {% endif %}
        </div>
        
        <div class="section">
            <h3>üìÖ Upcoming Bookings</h3>
            {% if upcoming_bookings %}
                <div class="booking-list">
                    {% for booking in upcoming_bookings %}
                        <div class="booking-item">
                            <strong>{{ booking.dog.name }}</strong> ({{ booking.dog.owner }})
                            <br>
                            <small>{{ booking.start_date|date:"m/d/Y" }} to {{ booking.end_date|date:"m/d/Y" }}</small>
                            <span class="status {{ booking.status }}">{{ booking.get_status_display }}</span>
                            {% if booking.kennel %}
                                <br><small><strong>Kennel:</strong> {{ booking.kennel.name }} ({{ booking.kennel.get_size_display }})</small>
                            {% else %}
                                <br><small><strong>Kennel:</strong> <em>Not assigned</em></small>
                            {% endif %}
                            {% if booking.total_amount %}
                                <br><small><strong>Amount:</strong> ${{ booking.total_amount }}</small>
                            {% endif %}
                            <br>
                            <a href="{% url 'staff_booking_detail' booking.id %}" class="doggy-btn">Manage</a>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>No upcoming bookings!</p>
            {% endif %}
        </div>
    </div>
    
    <div class="staff-actions">
        <a href="{% url 'staff_booking_list' %}" class="doggy-btn">View All Bookings</a>
        <a href="{% url 'staff_payment_list' %}" class="doggy-btn">Manage Payments</a>
        <a href="{% url 'staff_kennel_management' %}" class="doggy-btn">Manage Kennels</a>
        <a href="{% url 'staff_calendar' %}" class="doggy-btn">üìÖ Facility Calendar</a>
        <a href="/admin/" class="doggy-btn">Admin Panel</a>
    </div>
</div>

<style>
.filter-section {
    background: #fff;
    border: 2px solid #f7d08a;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 20px;
    overflow: hidden;
}
.filter-form {
    margin: 0;
}
.filter-controls {
    display: flex;
    align-items: center;
    gap: 15px;
    flex-wrap: wrap;
}
.filter-group {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
}
.filter-group label {
    color: #d2691e;
    font-weight: bold;
    white-space: nowrap;
}
.filter-control {
    padding: 8px;
    border: 1px solid #f7d08a;
    border-radius: 4px;
    font-size: 1em;
    background: #fff;
    color: #333;
    min-width: 120px;
}
.filter-controls .doggy-btn {
    padding: 8px 15px;
    margin: 0;
    white-space: nowrap;
}
.staff-stats {
    margin: 20px 0;
}
.stat-card {
    background: #fff;
    border: 2px solid #f7d08a;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 20px;
    overflow: hidden;
}
.staff-sections {
    display: grid;
    gap: 20px;
    margin: 20px 0;
}
.section {
    background: #fff;
    border: 2px solid #f7d08a;
    border-radius: 8px;
    padding: 15px;
    overflow: hidden;
}
.booking-list {
    margin-top: 10px;
}
.booking-item {
    border-bottom: 1px solid #f7d08a;
    padding: 10px 0;
    margin-bottom: 10px;
    word-wrap: break-word;
}
.booking-item:last-child {
    border-bottom: none;
}
.booking-item .doggy-btn {
    width: 100%;
    box-sizing: border-box;
    margin-top: 5px;
}
.status {
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.8em;
    font-weight: bold;
    white-space: nowrap;
}
.status.pending {
    background: #fff3cd;
    color: #856404;
}
.status.confirmed {
    background: #d4edda;
    color: #155724;
}
.status.completed {
    background: #d1ecf1;
    color: #0c5460;
}
.status.cancelled {
    background: #f8d7da;
    color: #721c24;
}
.staff-actions {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 20px;
    width: 100%;
}
.staff-actions .doggy-btn {
    width: 100%;
    box-sizing: border-box;
    margin: 0;
}
</style>
{% endblock %} 